<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>单线程与异步编程 | fe-notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/fe-notes/favicon.ico">
    <meta name="description" content="个人前端笔记">
    
    <link rel="preload" href="/fe-notes/assets/css/0.styles.9dfc6ff8.css" as="style"><link rel="preload" href="/fe-notes/assets/js/app.3a168dfd.js" as="script"><link rel="preload" href="/fe-notes/assets/js/2.c34af4f1.js" as="script"><link rel="preload" href="/fe-notes/assets/js/1.4e3eb9de.js" as="script"><link rel="preload" href="/fe-notes/assets/js/36.581317e2.js" as="script"><link rel="prefetch" href="/fe-notes/assets/js/10.d7790d7b.js"><link rel="prefetch" href="/fe-notes/assets/js/100.1d955b8c.js"><link rel="prefetch" href="/fe-notes/assets/js/101.9d24706c.js"><link rel="prefetch" href="/fe-notes/assets/js/102.2cddc8f3.js"><link rel="prefetch" href="/fe-notes/assets/js/103.31fd48a8.js"><link rel="prefetch" href="/fe-notes/assets/js/104.710bf344.js"><link rel="prefetch" href="/fe-notes/assets/js/105.5969f92a.js"><link rel="prefetch" href="/fe-notes/assets/js/106.5fe4dac3.js"><link rel="prefetch" href="/fe-notes/assets/js/107.cade6010.js"><link rel="prefetch" href="/fe-notes/assets/js/108.4906eb25.js"><link rel="prefetch" href="/fe-notes/assets/js/109.a0b391be.js"><link rel="prefetch" href="/fe-notes/assets/js/11.43eb9996.js"><link rel="prefetch" href="/fe-notes/assets/js/110.8c843cf7.js"><link rel="prefetch" href="/fe-notes/assets/js/111.81af13b5.js"><link rel="prefetch" href="/fe-notes/assets/js/112.eb75052c.js"><link rel="prefetch" href="/fe-notes/assets/js/113.d0aecf94.js"><link rel="prefetch" href="/fe-notes/assets/js/114.dc75fd2f.js"><link rel="prefetch" href="/fe-notes/assets/js/115.36915f02.js"><link rel="prefetch" href="/fe-notes/assets/js/116.cbc26f91.js"><link rel="prefetch" href="/fe-notes/assets/js/117.8e77424c.js"><link rel="prefetch" href="/fe-notes/assets/js/118.b167f107.js"><link rel="prefetch" href="/fe-notes/assets/js/119.0a10acf9.js"><link rel="prefetch" href="/fe-notes/assets/js/12.0ec02ddd.js"><link rel="prefetch" href="/fe-notes/assets/js/120.eb0aab57.js"><link rel="prefetch" href="/fe-notes/assets/js/121.3c95a197.js"><link rel="prefetch" href="/fe-notes/assets/js/122.32a6f602.js"><link rel="prefetch" href="/fe-notes/assets/js/123.a2b46063.js"><link rel="prefetch" href="/fe-notes/assets/js/124.099e5955.js"><link rel="prefetch" href="/fe-notes/assets/js/125.22cc3d5c.js"><link rel="prefetch" href="/fe-notes/assets/js/126.e3594885.js"><link rel="prefetch" href="/fe-notes/assets/js/127.c6f10455.js"><link rel="prefetch" href="/fe-notes/assets/js/128.ce24aecc.js"><link rel="prefetch" href="/fe-notes/assets/js/129.fc3e5554.js"><link rel="prefetch" href="/fe-notes/assets/js/13.78152d0b.js"><link rel="prefetch" href="/fe-notes/assets/js/130.c5c3742c.js"><link rel="prefetch" href="/fe-notes/assets/js/131.7a360af2.js"><link rel="prefetch" href="/fe-notes/assets/js/132.9d4fe360.js"><link rel="prefetch" href="/fe-notes/assets/js/133.c463096e.js"><link rel="prefetch" href="/fe-notes/assets/js/134.e2b52323.js"><link rel="prefetch" href="/fe-notes/assets/js/135.bd6d20a6.js"><link rel="prefetch" href="/fe-notes/assets/js/136.872158e5.js"><link rel="prefetch" href="/fe-notes/assets/js/137.5b3a875b.js"><link rel="prefetch" href="/fe-notes/assets/js/138.7685ef53.js"><link rel="prefetch" href="/fe-notes/assets/js/139.c5bb726d.js"><link rel="prefetch" href="/fe-notes/assets/js/14.6a9ef67a.js"><link rel="prefetch" href="/fe-notes/assets/js/140.9dec21eb.js"><link rel="prefetch" href="/fe-notes/assets/js/141.f337e59f.js"><link rel="prefetch" href="/fe-notes/assets/js/142.2c46c119.js"><link rel="prefetch" href="/fe-notes/assets/js/143.fa39f9c3.js"><link rel="prefetch" href="/fe-notes/assets/js/144.1a3a6ecc.js"><link rel="prefetch" href="/fe-notes/assets/js/145.4bb9d8ab.js"><link rel="prefetch" href="/fe-notes/assets/js/146.feadf802.js"><link rel="prefetch" href="/fe-notes/assets/js/147.07092725.js"><link rel="prefetch" href="/fe-notes/assets/js/148.23197f81.js"><link rel="prefetch" href="/fe-notes/assets/js/149.f4ac5c5c.js"><link rel="prefetch" href="/fe-notes/assets/js/15.96c9bf57.js"><link rel="prefetch" href="/fe-notes/assets/js/150.06a0409e.js"><link rel="prefetch" href="/fe-notes/assets/js/151.9879c192.js"><link rel="prefetch" href="/fe-notes/assets/js/152.c0ab61ec.js"><link rel="prefetch" href="/fe-notes/assets/js/153.621611fb.js"><link rel="prefetch" href="/fe-notes/assets/js/154.7f7453d5.js"><link rel="prefetch" href="/fe-notes/assets/js/155.56e356d3.js"><link rel="prefetch" href="/fe-notes/assets/js/156.0d733aa0.js"><link rel="prefetch" href="/fe-notes/assets/js/157.d241e320.js"><link rel="prefetch" href="/fe-notes/assets/js/158.844d5b84.js"><link rel="prefetch" href="/fe-notes/assets/js/159.61ba14f0.js"><link rel="prefetch" href="/fe-notes/assets/js/16.a80ecebb.js"><link rel="prefetch" href="/fe-notes/assets/js/160.f986bb29.js"><link rel="prefetch" href="/fe-notes/assets/js/161.c4315e4c.js"><link rel="prefetch" href="/fe-notes/assets/js/162.e69545e8.js"><link rel="prefetch" href="/fe-notes/assets/js/163.7cf2fcf0.js"><link rel="prefetch" href="/fe-notes/assets/js/164.77a48e63.js"><link rel="prefetch" href="/fe-notes/assets/js/165.a0327df4.js"><link rel="prefetch" href="/fe-notes/assets/js/166.2e16f205.js"><link rel="prefetch" href="/fe-notes/assets/js/167.f1a6a09c.js"><link rel="prefetch" href="/fe-notes/assets/js/168.cc9b8512.js"><link rel="prefetch" href="/fe-notes/assets/js/169.86e0fc4a.js"><link rel="prefetch" href="/fe-notes/assets/js/17.7102de0b.js"><link rel="prefetch" href="/fe-notes/assets/js/170.4b2c626c.js"><link rel="prefetch" href="/fe-notes/assets/js/171.f26c3435.js"><link rel="prefetch" href="/fe-notes/assets/js/172.8376be78.js"><link rel="prefetch" href="/fe-notes/assets/js/173.1e31f20a.js"><link rel="prefetch" href="/fe-notes/assets/js/174.9281dfa6.js"><link rel="prefetch" href="/fe-notes/assets/js/175.a84992e1.js"><link rel="prefetch" href="/fe-notes/assets/js/176.7bba3bf4.js"><link rel="prefetch" href="/fe-notes/assets/js/177.46fddad0.js"><link rel="prefetch" href="/fe-notes/assets/js/178.ed7ceb77.js"><link rel="prefetch" href="/fe-notes/assets/js/179.3d3d643e.js"><link rel="prefetch" href="/fe-notes/assets/js/18.5d340b88.js"><link rel="prefetch" href="/fe-notes/assets/js/180.1696ffc1.js"><link rel="prefetch" href="/fe-notes/assets/js/181.0dfd8494.js"><link rel="prefetch" href="/fe-notes/assets/js/182.0a3093e6.js"><link rel="prefetch" href="/fe-notes/assets/js/183.942c5c6e.js"><link rel="prefetch" href="/fe-notes/assets/js/184.29420180.js"><link rel="prefetch" href="/fe-notes/assets/js/185.49767fd0.js"><link rel="prefetch" href="/fe-notes/assets/js/186.aa8b2ae5.js"><link rel="prefetch" href="/fe-notes/assets/js/187.a0eb883b.js"><link rel="prefetch" href="/fe-notes/assets/js/188.8cb11493.js"><link rel="prefetch" href="/fe-notes/assets/js/189.d36d2136.js"><link rel="prefetch" href="/fe-notes/assets/js/19.d89d2c3c.js"><link rel="prefetch" href="/fe-notes/assets/js/190.a68f68f2.js"><link rel="prefetch" href="/fe-notes/assets/js/191.0c7f2386.js"><link rel="prefetch" href="/fe-notes/assets/js/192.cefa25dc.js"><link rel="prefetch" href="/fe-notes/assets/js/193.9606090a.js"><link rel="prefetch" href="/fe-notes/assets/js/194.e54a0766.js"><link rel="prefetch" href="/fe-notes/assets/js/195.e7bb65d2.js"><link rel="prefetch" href="/fe-notes/assets/js/196.78ff12d4.js"><link rel="prefetch" href="/fe-notes/assets/js/197.6fc5eaa5.js"><link rel="prefetch" href="/fe-notes/assets/js/198.79a003b7.js"><link rel="prefetch" href="/fe-notes/assets/js/199.dc2426ef.js"><link rel="prefetch" href="/fe-notes/assets/js/20.f4c8ca34.js"><link rel="prefetch" href="/fe-notes/assets/js/200.b2c97b9f.js"><link rel="prefetch" href="/fe-notes/assets/js/201.ba237c96.js"><link rel="prefetch" href="/fe-notes/assets/js/202.eff59685.js"><link rel="prefetch" href="/fe-notes/assets/js/203.2bf94c82.js"><link rel="prefetch" href="/fe-notes/assets/js/204.9a6b12e1.js"><link rel="prefetch" href="/fe-notes/assets/js/205.98bdf8a6.js"><link rel="prefetch" href="/fe-notes/assets/js/206.4b5a5115.js"><link rel="prefetch" href="/fe-notes/assets/js/207.77825369.js"><link rel="prefetch" href="/fe-notes/assets/js/208.548a77d2.js"><link rel="prefetch" href="/fe-notes/assets/js/209.e286bf98.js"><link rel="prefetch" href="/fe-notes/assets/js/21.5bbaf191.js"><link rel="prefetch" href="/fe-notes/assets/js/210.4ff22200.js"><link rel="prefetch" href="/fe-notes/assets/js/211.87d3b9f8.js"><link rel="prefetch" href="/fe-notes/assets/js/212.4baf5fe5.js"><link rel="prefetch" href="/fe-notes/assets/js/213.3501d1a5.js"><link rel="prefetch" href="/fe-notes/assets/js/214.5a119be9.js"><link rel="prefetch" href="/fe-notes/assets/js/215.6422dca4.js"><link rel="prefetch" href="/fe-notes/assets/js/216.8c8f3a4b.js"><link rel="prefetch" href="/fe-notes/assets/js/217.ada49303.js"><link rel="prefetch" href="/fe-notes/assets/js/218.3f120dd4.js"><link rel="prefetch" href="/fe-notes/assets/js/219.616fc91d.js"><link rel="prefetch" href="/fe-notes/assets/js/22.83b320f6.js"><link rel="prefetch" href="/fe-notes/assets/js/220.93d0a052.js"><link rel="prefetch" href="/fe-notes/assets/js/221.51cf766b.js"><link rel="prefetch" href="/fe-notes/assets/js/222.e21e73c3.js"><link rel="prefetch" href="/fe-notes/assets/js/223.09fe9120.js"><link rel="prefetch" href="/fe-notes/assets/js/224.d3b8e804.js"><link rel="prefetch" href="/fe-notes/assets/js/225.a19e67ae.js"><link rel="prefetch" href="/fe-notes/assets/js/226.36a44120.js"><link rel="prefetch" href="/fe-notes/assets/js/227.b2c63337.js"><link rel="prefetch" href="/fe-notes/assets/js/228.0a3e57ef.js"><link rel="prefetch" href="/fe-notes/assets/js/229.4279d959.js"><link rel="prefetch" href="/fe-notes/assets/js/23.59831ed6.js"><link rel="prefetch" href="/fe-notes/assets/js/230.14340350.js"><link rel="prefetch" href="/fe-notes/assets/js/231.83eddc3c.js"><link rel="prefetch" href="/fe-notes/assets/js/232.53f8de83.js"><link rel="prefetch" href="/fe-notes/assets/js/233.03f38b0a.js"><link rel="prefetch" href="/fe-notes/assets/js/234.367e67a6.js"><link rel="prefetch" href="/fe-notes/assets/js/235.d7ac7ea1.js"><link rel="prefetch" href="/fe-notes/assets/js/236.e9d676aa.js"><link rel="prefetch" href="/fe-notes/assets/js/237.88d88d4f.js"><link rel="prefetch" href="/fe-notes/assets/js/238.be5d9976.js"><link rel="prefetch" href="/fe-notes/assets/js/239.10c47781.js"><link rel="prefetch" href="/fe-notes/assets/js/24.d171b1da.js"><link rel="prefetch" href="/fe-notes/assets/js/240.7f7e9057.js"><link rel="prefetch" href="/fe-notes/assets/js/241.521afa4f.js"><link rel="prefetch" href="/fe-notes/assets/js/242.06d6e1f2.js"><link rel="prefetch" href="/fe-notes/assets/js/243.fcbff541.js"><link rel="prefetch" href="/fe-notes/assets/js/244.e99cb2dd.js"><link rel="prefetch" href="/fe-notes/assets/js/245.04b2f65e.js"><link rel="prefetch" href="/fe-notes/assets/js/246.456fc3bb.js"><link rel="prefetch" href="/fe-notes/assets/js/247.b5d332b3.js"><link rel="prefetch" href="/fe-notes/assets/js/248.495feadb.js"><link rel="prefetch" href="/fe-notes/assets/js/249.d0880af5.js"><link rel="prefetch" href="/fe-notes/assets/js/25.f92c4de3.js"><link rel="prefetch" href="/fe-notes/assets/js/250.8bc64327.js"><link rel="prefetch" href="/fe-notes/assets/js/251.7b89b6ac.js"><link rel="prefetch" href="/fe-notes/assets/js/252.97c7df28.js"><link rel="prefetch" href="/fe-notes/assets/js/253.e20644d7.js"><link rel="prefetch" href="/fe-notes/assets/js/254.cc96b633.js"><link rel="prefetch" href="/fe-notes/assets/js/255.308b98f4.js"><link rel="prefetch" href="/fe-notes/assets/js/256.01ae4bda.js"><link rel="prefetch" href="/fe-notes/assets/js/257.77c761c3.js"><link rel="prefetch" href="/fe-notes/assets/js/258.c15465ff.js"><link rel="prefetch" href="/fe-notes/assets/js/259.2ea4e9ab.js"><link rel="prefetch" href="/fe-notes/assets/js/26.d2fda899.js"><link rel="prefetch" href="/fe-notes/assets/js/260.5ef72e6e.js"><link rel="prefetch" href="/fe-notes/assets/js/261.df9e83c0.js"><link rel="prefetch" href="/fe-notes/assets/js/262.9f93dcbe.js"><link rel="prefetch" href="/fe-notes/assets/js/263.c895b59f.js"><link rel="prefetch" href="/fe-notes/assets/js/264.d8f787f9.js"><link rel="prefetch" href="/fe-notes/assets/js/265.e3c0ad58.js"><link rel="prefetch" href="/fe-notes/assets/js/266.6dfa8dae.js"><link rel="prefetch" href="/fe-notes/assets/js/267.2b47ccf2.js"><link rel="prefetch" href="/fe-notes/assets/js/268.ac30a03c.js"><link rel="prefetch" href="/fe-notes/assets/js/269.59de5cc6.js"><link rel="prefetch" href="/fe-notes/assets/js/27.6f9f1e03.js"><link rel="prefetch" href="/fe-notes/assets/js/270.ff1af94e.js"><link rel="prefetch" href="/fe-notes/assets/js/271.7f7152b9.js"><link rel="prefetch" href="/fe-notes/assets/js/272.5a05bcd2.js"><link rel="prefetch" href="/fe-notes/assets/js/273.204eac02.js"><link rel="prefetch" href="/fe-notes/assets/js/274.c0757056.js"><link rel="prefetch" href="/fe-notes/assets/js/275.7292b33e.js"><link rel="prefetch" href="/fe-notes/assets/js/276.9009e9da.js"><link rel="prefetch" href="/fe-notes/assets/js/277.da98194e.js"><link rel="prefetch" href="/fe-notes/assets/js/278.3bb8658f.js"><link rel="prefetch" href="/fe-notes/assets/js/279.c6bcfee6.js"><link rel="prefetch" href="/fe-notes/assets/js/28.d9ce88ab.js"><link rel="prefetch" href="/fe-notes/assets/js/280.248894e0.js"><link rel="prefetch" href="/fe-notes/assets/js/281.15920b4e.js"><link rel="prefetch" href="/fe-notes/assets/js/282.b531ba4c.js"><link rel="prefetch" href="/fe-notes/assets/js/283.e121220c.js"><link rel="prefetch" href="/fe-notes/assets/js/284.1e0cb73a.js"><link rel="prefetch" href="/fe-notes/assets/js/285.0440eb1e.js"><link rel="prefetch" href="/fe-notes/assets/js/286.4a7e1a2f.js"><link rel="prefetch" href="/fe-notes/assets/js/287.29c4e416.js"><link rel="prefetch" href="/fe-notes/assets/js/288.1f60f880.js"><link rel="prefetch" href="/fe-notes/assets/js/289.fbac4928.js"><link rel="prefetch" href="/fe-notes/assets/js/29.f3537421.js"><link rel="prefetch" href="/fe-notes/assets/js/290.5d24e679.js"><link rel="prefetch" href="/fe-notes/assets/js/291.a0cb5378.js"><link rel="prefetch" href="/fe-notes/assets/js/292.c307b453.js"><link rel="prefetch" href="/fe-notes/assets/js/293.18448a41.js"><link rel="prefetch" href="/fe-notes/assets/js/294.500016fa.js"><link rel="prefetch" href="/fe-notes/assets/js/295.3fb59e7d.js"><link rel="prefetch" href="/fe-notes/assets/js/296.7e418486.js"><link rel="prefetch" href="/fe-notes/assets/js/297.82d7b094.js"><link rel="prefetch" href="/fe-notes/assets/js/298.72b92f13.js"><link rel="prefetch" href="/fe-notes/assets/js/299.ed068b58.js"><link rel="prefetch" href="/fe-notes/assets/js/3.5ca5fa31.js"><link rel="prefetch" href="/fe-notes/assets/js/30.790cbfec.js"><link rel="prefetch" href="/fe-notes/assets/js/300.decd1c50.js"><link rel="prefetch" href="/fe-notes/assets/js/301.ac6c64b3.js"><link rel="prefetch" href="/fe-notes/assets/js/302.2f655351.js"><link rel="prefetch" href="/fe-notes/assets/js/303.214297cf.js"><link rel="prefetch" href="/fe-notes/assets/js/304.c8cb3d25.js"><link rel="prefetch" href="/fe-notes/assets/js/305.490b0bf4.js"><link rel="prefetch" href="/fe-notes/assets/js/306.bf59d4e6.js"><link rel="prefetch" href="/fe-notes/assets/js/307.ed6d223a.js"><link rel="prefetch" href="/fe-notes/assets/js/308.199b4fa5.js"><link rel="prefetch" href="/fe-notes/assets/js/309.645fbe73.js"><link rel="prefetch" href="/fe-notes/assets/js/31.b4fd35fa.js"><link rel="prefetch" href="/fe-notes/assets/js/310.6e0d92ae.js"><link rel="prefetch" href="/fe-notes/assets/js/311.6e51f6a5.js"><link rel="prefetch" href="/fe-notes/assets/js/312.e4ea1a16.js"><link rel="prefetch" href="/fe-notes/assets/js/313.a01c6561.js"><link rel="prefetch" href="/fe-notes/assets/js/314.f728f9ce.js"><link rel="prefetch" href="/fe-notes/assets/js/32.be19715e.js"><link rel="prefetch" href="/fe-notes/assets/js/33.2f32c378.js"><link rel="prefetch" href="/fe-notes/assets/js/34.009bd566.js"><link rel="prefetch" href="/fe-notes/assets/js/35.5c78a91a.js"><link rel="prefetch" href="/fe-notes/assets/js/37.812a4308.js"><link rel="prefetch" href="/fe-notes/assets/js/38.1daf6af2.js"><link rel="prefetch" href="/fe-notes/assets/js/39.09f1ff29.js"><link rel="prefetch" href="/fe-notes/assets/js/4.33a435b7.js"><link rel="prefetch" href="/fe-notes/assets/js/40.20f65c42.js"><link rel="prefetch" href="/fe-notes/assets/js/41.322bd69f.js"><link rel="prefetch" href="/fe-notes/assets/js/42.9c72ca98.js"><link rel="prefetch" href="/fe-notes/assets/js/43.be9ec593.js"><link rel="prefetch" href="/fe-notes/assets/js/44.5d8b8a00.js"><link rel="prefetch" href="/fe-notes/assets/js/45.696e9597.js"><link rel="prefetch" href="/fe-notes/assets/js/46.793b2e02.js"><link rel="prefetch" href="/fe-notes/assets/js/47.fde1af0c.js"><link rel="prefetch" href="/fe-notes/assets/js/48.344fd853.js"><link rel="prefetch" href="/fe-notes/assets/js/49.2cf00938.js"><link rel="prefetch" href="/fe-notes/assets/js/5.7702ef90.js"><link rel="prefetch" href="/fe-notes/assets/js/50.baeea84b.js"><link rel="prefetch" href="/fe-notes/assets/js/51.30cc959c.js"><link rel="prefetch" href="/fe-notes/assets/js/52.8854a312.js"><link rel="prefetch" href="/fe-notes/assets/js/53.ae8e1467.js"><link rel="prefetch" href="/fe-notes/assets/js/54.5e25191a.js"><link rel="prefetch" href="/fe-notes/assets/js/55.47fc6868.js"><link rel="prefetch" href="/fe-notes/assets/js/56.b128d2d2.js"><link rel="prefetch" href="/fe-notes/assets/js/57.c82eb695.js"><link rel="prefetch" href="/fe-notes/assets/js/58.754ea6d5.js"><link rel="prefetch" href="/fe-notes/assets/js/59.8aac596b.js"><link rel="prefetch" href="/fe-notes/assets/js/6.5e57a940.js"><link rel="prefetch" href="/fe-notes/assets/js/60.81a67502.js"><link rel="prefetch" href="/fe-notes/assets/js/61.ac2837dd.js"><link rel="prefetch" href="/fe-notes/assets/js/62.e07c5ccb.js"><link rel="prefetch" href="/fe-notes/assets/js/63.29c0768c.js"><link rel="prefetch" href="/fe-notes/assets/js/64.04780b9d.js"><link rel="prefetch" href="/fe-notes/assets/js/65.0e71cdd9.js"><link rel="prefetch" href="/fe-notes/assets/js/66.0da8e639.js"><link rel="prefetch" href="/fe-notes/assets/js/67.753b9757.js"><link rel="prefetch" href="/fe-notes/assets/js/68.65544092.js"><link rel="prefetch" href="/fe-notes/assets/js/69.7d1c774a.js"><link rel="prefetch" href="/fe-notes/assets/js/7.527996d3.js"><link rel="prefetch" href="/fe-notes/assets/js/70.e098ec13.js"><link rel="prefetch" href="/fe-notes/assets/js/71.7dac9581.js"><link rel="prefetch" href="/fe-notes/assets/js/72.7b1ea4e0.js"><link rel="prefetch" href="/fe-notes/assets/js/73.7a264496.js"><link rel="prefetch" href="/fe-notes/assets/js/74.4a29c8dc.js"><link rel="prefetch" href="/fe-notes/assets/js/75.4a2b29b4.js"><link rel="prefetch" href="/fe-notes/assets/js/76.030d5bb9.js"><link rel="prefetch" href="/fe-notes/assets/js/77.e69f2a68.js"><link rel="prefetch" href="/fe-notes/assets/js/78.5c815799.js"><link rel="prefetch" href="/fe-notes/assets/js/79.89a07250.js"><link rel="prefetch" href="/fe-notes/assets/js/80.2965b576.js"><link rel="prefetch" href="/fe-notes/assets/js/81.8e11b1c2.js"><link rel="prefetch" href="/fe-notes/assets/js/82.1f18bd60.js"><link rel="prefetch" href="/fe-notes/assets/js/83.ee033c22.js"><link rel="prefetch" href="/fe-notes/assets/js/84.1f8cdfc7.js"><link rel="prefetch" href="/fe-notes/assets/js/85.a12fff11.js"><link rel="prefetch" href="/fe-notes/assets/js/86.99b7434c.js"><link rel="prefetch" href="/fe-notes/assets/js/87.5d460eff.js"><link rel="prefetch" href="/fe-notes/assets/js/88.88b923f7.js"><link rel="prefetch" href="/fe-notes/assets/js/89.1a38fcee.js"><link rel="prefetch" href="/fe-notes/assets/js/90.d59147ab.js"><link rel="prefetch" href="/fe-notes/assets/js/91.ad2cc9ae.js"><link rel="prefetch" href="/fe-notes/assets/js/92.341adf0b.js"><link rel="prefetch" href="/fe-notes/assets/js/93.f36b6992.js"><link rel="prefetch" href="/fe-notes/assets/js/94.848acf99.js"><link rel="prefetch" href="/fe-notes/assets/js/95.667d4de6.js"><link rel="prefetch" href="/fe-notes/assets/js/96.db4750cb.js"><link rel="prefetch" href="/fe-notes/assets/js/97.9176576e.js"><link rel="prefetch" href="/fe-notes/assets/js/98.92a31692.js"><link rel="prefetch" href="/fe-notes/assets/js/99.9d82da57.js"><link rel="prefetch" href="/fe-notes/assets/js/vendors~docsearch.bcd2b443.js">
    <link rel="stylesheet" href="/fe-notes/assets/css/0.styles.9dfc6ff8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fe-notes/" class="home-link router-link-active"><!----> <span class="site-name">fe-notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fe-notes/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/css/" class="nav-link">
  HTML&amp;CSS
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/javascript/" class="nav-link router-link-active">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><a href="/fe-notes/jquery/" class="nav-link">
  jQuery
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/vue/" class="nav-link">
  Vue2.x
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/vue-router/" class="nav-link">
  Vue Router
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/vuex/" class="nav-link">
  Vuex
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/vue-3.x/" class="nav-link">
  Vue3.x
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/transition/" class="nav-link">
  Transition
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/react-router/" class="nav-link">
  React Router
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/nextjs/" class="nav-link">
  Next
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/typescript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/redux/" class="nav-link">
  Redux
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/jest/" class="nav-link">
  Jest
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/testing-library/" class="nav-link">
  Testing Library
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/lint/" class="nav-link">
  代码规范
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NodeJS" class="dropdown-title"><span class="title">NodeJS</span> <span class="arrow down"></span></button> <button type="button" aria-label="NodeJS" class="mobile-dropdown-title"><span class="title">NodeJS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/nodejs/" class="nav-link">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/npm/" class="nav-link">
  npm
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/yarn/" class="nav-link">
  Yarn
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/electron/" class="nav-link">
  Electron
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机通识" class="dropdown-title"><span class="title">计算机通识</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机通识" class="mobile-dropdown-title"><span class="title">计算机通识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/distilled/" class="nav-link">
  《计算机科学精粹》
</a></li><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-notes/algorithm/" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/fe-notes/leetcode/" class="nav-link">
  LeetCode
</a></li></ul></li><li class="dropdown-item"><h4>
          网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-notes/tcp/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/fe-notes/http/" class="nav-link">
  HTTP(S)
</a></li><li class="dropdown-subitem"><a href="/fe-notes/network/" class="nav-link">
  网络综合
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-notes/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/fe-notes/docker/" class="nav-link">
  Docker
</a></li></ul></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-notes/design/" class="nav-link">
  常见
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/handlebars/" class="nav-link">
  Handlebars
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/trick/" class="nav-link">
  踩坑
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/copywriting/" class="nav-link">
  文案排版
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/repository/" class="nav-link">
  网站
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/license/" class="nav-link">
  协议
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/ps/" class="nav-link">
  Photoshop
</a></li></ul></div></div><div class="nav-item"><a href="https://forlornlily.github.io/server-notes/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端开发
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/ForlornLily/fe-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fe-notes/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/css/" class="nav-link">
  HTML&amp;CSS
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/javascript/" class="nav-link router-link-active">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><a href="/fe-notes/jquery/" class="nav-link">
  jQuery
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/vue/" class="nav-link">
  Vue2.x
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/vue-router/" class="nav-link">
  Vue Router
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/vuex/" class="nav-link">
  Vuex
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/vue-3.x/" class="nav-link">
  Vue3.x
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/transition/" class="nav-link">
  Transition
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/react-router/" class="nav-link">
  React Router
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/nextjs/" class="nav-link">
  Next
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow down"></span></button> <button type="button" aria-label="工程化" class="mobile-dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/typescript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/redux/" class="nav-link">
  Redux
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/jest/" class="nav-link">
  Jest
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/testing-library/" class="nav-link">
  Testing Library
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/lint/" class="nav-link">
  代码规范
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NodeJS" class="dropdown-title"><span class="title">NodeJS</span> <span class="arrow down"></span></button> <button type="button" aria-label="NodeJS" class="mobile-dropdown-title"><span class="title">NodeJS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/nodejs/" class="nav-link">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/npm/" class="nav-link">
  npm
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/yarn/" class="nav-link">
  Yarn
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/electron/" class="nav-link">
  Electron
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机通识" class="dropdown-title"><span class="title">计算机通识</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机通识" class="mobile-dropdown-title"><span class="title">计算机通识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/distilled/" class="nav-link">
  《计算机科学精粹》
</a></li><li class="dropdown-item"><h4>
          算法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-notes/algorithm/" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/fe-notes/leetcode/" class="nav-link">
  LeetCode
</a></li></ul></li><li class="dropdown-item"><h4>
          网络
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-notes/tcp/" class="nav-link">
  TCP/IP
</a></li><li class="dropdown-subitem"><a href="/fe-notes/http/" class="nav-link">
  HTTP(S)
</a></li><li class="dropdown-subitem"><a href="/fe-notes/network/" class="nav-link">
  网络综合
</a></li></ul></li><li class="dropdown-item"><h4>
          操作系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-notes/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/fe-notes/docker/" class="nav-link">
  Docker
</a></li></ul></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe-notes/design/" class="nav-link">
  常见
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-notes/handlebars/" class="nav-link">
  Handlebars
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/trick/" class="nav-link">
  踩坑
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/copywriting/" class="nav-link">
  文案排版
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/repository/" class="nav-link">
  网站
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/license/" class="nav-link">
  协议
</a></li><li class="dropdown-item"><!----> <a href="/fe-notes/ps/" class="nav-link">
  Photoshop
</a></li></ul></div></div><div class="nav-item"><a href="https://forlornlily.github.io/server-notes/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端开发
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/ForlornLily/fe-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe-notes/javascript/" aria-current="page" class="sidebar-link">概要</a></li><li><a href="/fe-notes/javascript/001_introduce.html" class="sidebar-link">简介</a></li><li><a href="/fe-notes/javascript/002_script.html" class="sidebar-link">HTML 内使用</a></li><li><a href="/fe-notes/javascript/003_syntax.html" class="sidebar-link">语法</a></li><li><a href="/fe-notes/javascript/004_datatype.html" class="sidebar-link">数据类型</a></li><li><a href="/fe-notes/javascript/005_primitive_types.html" class="sidebar-link">简单数据类型/基本类型</a></li><li><a href="/fe-notes/javascript/006_boolean.html" class="sidebar-link">Boolean</a></li><li><a href="/fe-notes/javascript/007_number.html" class="sidebar-link">Number</a></li><li><a href="/fe-notes/javascript/008_string.html" class="sidebar-link">String</a></li><li><a href="/fe-notes/javascript/009_symbol.html" class="sidebar-link">Symbol</a></li><li><a href="/fe-notes/javascript/010_primitive_wrapper_types.html" class="sidebar-link">基本包装类型</a></li><li><a href="/fe-notes/javascript/012_complex_data.html" class="sidebar-link">复杂类型/引用类型</a></li><li><a href="/fe-notes/javascript/013_operator.html" class="sidebar-link">操作符</a></li><li><a href="/fe-notes/javascript/014_statement.html" class="sidebar-link">语句</a></li><li><a href="/fe-notes/javascript/019_transrule.html" class="sidebar-link">转换规则总结</a></li><li><a href="/fe-notes/javascript/020_scope.html" class="sidebar-link">变量和作用域</a></li><li><a href="/fe-notes/javascript/022_object.html" class="sidebar-link">引用类型细分</a></li><li><a href="/fe-notes/javascript/023_array.html" class="sidebar-link">Array</a></li><li><a href="/fe-notes/javascript/024_date.html" class="sidebar-link">Date</a></li><li><a href="/fe-notes/javascript/025_function.html" class="sidebar-link">Function</a></li><li><a href="/fe-notes/javascript/026_math.html" class="sidebar-link">Math</a></li><li><a href="/fe-notes/javascript/027_global.html" class="sidebar-link">Global</a></li><li><a href="/fe-notes/javascript/028_set.html" class="sidebar-link">Set</a></li><li><a href="/fe-notes/javascript/029_map.html" class="sidebar-link">Map</a></li><li><a href="/fe-notes/javascript/030_regexp.html" class="sidebar-link">RegExp</a></li><li><a href="/fe-notes/javascript/031_typed_array.html" class="sidebar-link">TypedArray</a></li><li><a href="/fe-notes/javascript/038_iterators.html" class="sidebar-link">迭代器和生成器</a></li><li><a href="/fe-notes/javascript/040_oop.html" class="sidebar-link">面向对象</a></li><li><a href="/fe-notes/javascript/045_proxy.html" class="sidebar-link">代理与反射</a></li><li><a href="/fe-notes/javascript/050_async.html" aria-current="page" class="active sidebar-link">单线程与异步编程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#任务队列" class="sidebar-link">任务队列</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#进程与线程" class="sidebar-link">进程与线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#事件模型" class="sidebar-link">事件模型</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#回调模式" class="sidebar-link">回调模式</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#task-与-microtask" class="sidebar-link">task 与 microtask</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#同源策略" class="sidebar-link">同源策略</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#限制" class="sidebar-link">限制</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#原因" class="sidebar-link">原因</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#安全" class="sidebar-link">安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#csrf" class="sidebar-link">CSRF</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#xss" class="sidebar-link">XSS</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#解决跨域" class="sidebar-link">解决跨域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#cors" class="sidebar-link">CORS</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#jsonp-json-with-padding" class="sidebar-link">JSONP(JSON with Padding)</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#服务器代理" class="sidebar-link">服务器代理</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#websocket" class="sidebar-link">WebSocket</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#xmlhttprequest" class="sidebar-link">XMLHttpRequest</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#属性" class="sidebar-link">属性</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#方法" class="sidebar-link">方法</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#其他" class="sidebar-link">其他</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#demo" class="sidebar-link">demo</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#promise" class="sidebar-link">Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#then-与-catch" class="sidebar-link">then 与 catch</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#链式调用" class="sidebar-link">链式调用</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#promise-all" class="sidebar-link">Promise.all()</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#promise-race" class="sidebar-link">Promise.race()</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#手写-promise-then" class="sidebar-link">手写 promise.then</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#promise-finally" class="sidebar-link">promise.finally</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#fetch" class="sidebar-link">Fetch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#reject-的情况" class="sidebar-link">reject 的情况</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#options" class="sidebar-link">options</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#headers" class="sidebar-link">Headers</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#request" class="sidebar-link">Request</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#response" class="sidebar-link">Response</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#跨域" class="sidebar-link">跨域</a></li><li class="sidebar-sub-header"><a href="/fe-notes/javascript/050_async.html#中断" class="sidebar-link">中断</a></li></ul></li></ul></li><li><a href="/fe-notes/javascript/052_bom.html" class="sidebar-link">BOM</a></li><li><a href="/fe-notes/javascript/053_dom.html" class="sidebar-link">DOM</a></li><li><a href="/fe-notes/javascript/054_size.html" class="sidebar-link">尺寸</a></li><li><a href="/fe-notes/javascript/060_events.html" class="sidebar-link">事件</a></li><li><a href="/fe-notes/javascript/061_animation.html" class="sidebar-link">动画</a></li><li><a href="/fe-notes/javascript/062_html5.html" class="sidebar-link">HTML5 编程</a></li><li><a href="/fe-notes/javascript/063_error.html" class="sidebar-link">错误处理</a></li><li><a href="/fe-notes/javascript/065_json.html" class="sidebar-link">JSON</a></li><li><a href="/fe-notes/javascript/070_storage.html" class="sidebar-link">离线和存储</a></li><li><a href="/fe-notes/javascript/075_modules.html" class="sidebar-link">模块 modules</a></li><li><a href="/fe-notes/javascript/080_web_worker.html" class="sidebar-link">Web Worker</a></li><li><a href="/fe-notes/javascript/090_curry.html" class="sidebar-link">函数柯里化</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="单线程与异步编程"><a href="#单线程与异步编程" class="header-anchor">#</a> 单线程与异步编程</h1> <h2 id="任务队列"><a href="#任务队列" class="header-anchor">#</a> 任务队列</h2> <p>参考<a href="https://juejin.im/post/59e85eebf265da430d571f89" target="_blank" rel="noopener noreferrer">这一次，彻底弄懂 JavaScript 执行机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
当我们打开网站时，网页的渲染过程就是一大堆同步任务，比如页面骨架和页面元素的渲染。<br>
而像加载图片音乐之类占用资源大耗时久的任务，就是异步任务</p> <p>setTimeout 的第二个参数告诉浏览器要经过多久时间放到任务队列里。</p> <p>经过这个时间，如果任务队列为空，立刻执行，否则等任务队列的其他代码执行后再执行 setTimeout</p> <p><img src="/fe-notes/assets/img/c55f535f53f7d254ffd19ef216143ead.c55f535f.png" alt=""></p> <p>JS 是单线程的。</p> <p>根据执行顺序进入队列，只要进程处于空闲状态，就会尽快执行队列里的代码</p> <h2 id="进程与线程"><a href="#进程与线程" class="header-anchor">#</a> 进程与线程</h2> <p>参考知乎讨论<a href="https://www.zhihu.com/question/25532384" target="_blank" rel="noopener noreferrer">线程和进程的区别是什么？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
一般来说颗粒度进程（process）大于线程（thread）</p> <h3 id="事件模型"><a href="#事件模型" class="header-anchor">#</a> 事件模型</h3> <p>事件（比如 click），只有当点击的时候才会把事件对应的函数放到任务队列内</p> <h3 id="回调模式"><a href="#回调模式" class="header-anchor">#</a> 回调模式</h3> <p>以 NodeJS 读取文件为例。readFile 会立刻进入任务队列，等到读取结束以后的，触发的回调才进入任务队列</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;example.txt&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> contents</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>contents<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hi!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者以 jQuery 的<code>$.ajax</code>为例，$.ajax 会立刻进入任务队列，后台返回成功之后，<code>success</code>才进入任务队列</p> <div class="language-js extra-class"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="task-与-microtask"><a href="#task-与-microtask" class="header-anchor">#</a> task 与 microtask</h3> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>宏任务这个词不严谨，根据规范只有 task 和 microtask，参考<a href="https://www.zhihu.com/question/302612139" target="_blank" rel="noopener noreferrer">知乎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p>以下事件属于 task：</p> <ul><li><p>setInterval()</p></li> <li><p>setTimeout()</p></li> <li><p>ajax</p></li> <li><p>鼠标键盘事件</p></li></ul> <p>以下事件属于 microtask</p> <p>Promise.then</p> <ul><li><p>当前执行栈执行完毕时会立刻先处理所有微任务队列中的事件，然后再去队列（job queue）中取出一个事件。同一次事件循环中，微任务永远在 task 之前执行。</p></li> <li><p>所有 setTimeout()的回调都会进入到 setTimeout 任务队列，所有 then()回调都会进入到 then 队列</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;12&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
浏览器结果  1 7 8 2 4 5 9 11 12
解释：
第一轮task：1 7 
第一轮微任务：8 
-----第一轮结束-----
第二轮task：第一个setTimeout 2 4  
第二轮微任务：第一个setTimeout内的微任务5 
-----第二轮结束-----
第三轮task：第二个setTimeout 9 11  
第三轮微任务：第二个setTimeout内的微任务 12
*/</span>
</code></pre></div><h2 id="同源策略"><a href="#同源策略" class="header-anchor">#</a> 同源策略</h2> <p>源（origin）就是协议、域名和端口号</p> <p>地址里面的协议（比如 HTTP 和 HTTPS）、域名和端口号均相同则属于同源</p> <p>同源策略是浏览器的一个安全功能，不同源的客户端脚本在没有明确授权的情况下，不能读写对方资源。所以 a.com 下的 js 脚本采用 ajax 读取 b.com 里面的文件数据是会报错的</p> <h3 id="限制"><a href="#限制" class="header-anchor">#</a> 限制</h3> <ul><li><p>Cookie、web storage 和 IndexedDB 无法读取。</p></li> <li><p>DOM 无法获得。</p></li> <li><p>简单请求会发出，但 response 会被浏览器拦截。复杂请求有预检，request 直接被拦截</p></li></ul> <p>不受同源策略限制的：</p> <ul><li><p>页面中的链接，重定向以及表单提交是不会受到同源策略限制的。</p></li> <li><p>跨域资源的引入是可以的。但是 js 不能读写加载的内容。如嵌入到页面中的<code>&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;</code>，<code>&lt;img&gt;</code>，<code>&lt;link&gt;</code>，<code>&lt;iframe&gt;</code>等。</p></li></ul> <h3 id="原因"><a href="#原因" class="header-anchor">#</a> 原因</h3> <p>虽然请求跨域了，实际上还是发出请求了</p> <p>跨域是为了阻止用户读取到另一个域名下的内容，Ajax 可以获取响应，浏览器认为这不安全，所以拦截了响应。但是表单并不会获取新的内容，所以可以发起跨域请求</p> <h2 id="安全"><a href="#安全" class="header-anchor">#</a> 安全</h2> <h3 id="csrf"><a href="#csrf" class="header-anchor">#</a> CSRF</h3> <p>Cross-Site Request Forgery 跨站点请求伪造<br>
CSRF 是基于客户端对用户的信任。例如：
用户登录 A 网站 →A 网站确认身份 →B 网站向 A 网站发送请求（带 A 网站的身份）<br>
比如用 get 请求的时候，url 里面是能看到参数的，比如 xxx?id=2</p> <p>任何人都可以拿到甚至自己修改 id 是 3，服务器需要验证请求者是否有权限这个 url</p> <p>构造出一个后端请求地址，诱导用户点击或者通过某些途径自动发起请求。如果用户是在登录状态下的话，后端就以为是用户在操作，从而进行相应的逻辑<br>
参考<a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html" target="_blank" rel="noopener noreferrer">前端安全系列（二）：如何防止 CSRF 攻击？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
解决方案：</p> <ul><li>判断 cookie 是否同源操作<br>
HTTP 请求的时候 RequestHeader 会带上 OriginHeader 和 RefererHeader，服务器可以解析这两者内的域名
<ul><li>Origin 包含请求的域名</li> <li>Referer，记录了该 HTTP 请求的来源地址:<br>
Ajax 请求，图片和 script 等资源请求，Referer 为发起请求的页面地址;<br>
页面跳转，Referer 为打开页面历史记录的前一个页面地址</li></ul></li> <li>设置 cookie 的<code>samesite</code>（IE11+）
如果 SamesiteCookie 被设置为 Strict，浏览器在任何跨域请求中都不会携带 Cookie<br>
也就是跳转子域名或者是新标签重新打开刚登陆的网站，之前的 Cookie 都不会存在。尤其是有登录的网站，那么我们新打开一个标签进入，或者跳转到子域名的网站，都需要重新登录</li></ul> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">foo=1; Samesite=Strict</span></span>
</code></pre></div><p>如果 SamesiteCookie 被设置为 Lax，那么其他网站通过页面跳转过来的时候可以使用 Cookie，可以保障外域连接打开页面时用户的登录状态。<br>
但子域名也无法使用</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">bar=2; Samesite=Lax</span></span>
</code></pre></div><ul><li>以 SSL 连接</li> <li>每次请求都要带验证码(token)。
get 改成 post 也没有用，使用 cookie 也不行，可以伪造</li></ul> <h3 id="xss"><a href="#xss" class="header-anchor">#</a> XSS</h3> <p>Cross-Site Scripting(为了和 CSS 区分，这里把攻击的第一个字母改成了 X，于是叫做 XSS)<br>
跨站脚本攻击，主要是前端层面的，用户在输入层面插入攻击脚本，改变页面的显示，或则窃取网站
cookie</p> <p>预防方法：不相信用户的所有操作，对用户输入进行一个转义，不允许 js 对 cookie
的读写<br>
参考<a href="https://tech.meituan.com/2018/09/27/fe-security.html" target="_blank" rel="noopener noreferrer">前端安全系列（一）：如何防止 XSS 攻击？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
比如：</p> <ul><li>前端负责页面渲染，与后台只有 ajax 交互。可以防止在服务端取出恶意代码后，插入到响应 HTML 的 XSS</li> <li>如果是为了 SEO，需要后台渲染 HTML 的，用成熟的转义库，对后台的 HTML 模板（比如 ejs）进行进行充分的转义</li> <li>在 Vue 中少用<code>v-html</code>指令</li> <li>设置 httpOnly</li> <li>验证码</li></ul> <h2 id="解决跨域"><a href="#解决跨域" class="header-anchor">#</a> 解决跨域</h2> <p>跨域大概可以分为 iframe 的跨域和纯粹的跨全域请求</p> <h3 id="cors"><a href="#cors" class="header-anchor">#</a> CORS</h3> <p>cross-origin resource sharing 跨域资源共享</p> <p>利用自定义的 HTTP 头部让浏览器和服务器之间沟通</p> <p>返回头里设置<code>Access-Control-Allow-Origin</code>，如果值是*，那么可以接收任意域名的请求。否则要与与请求头(request
headers)中 Origin 一致才能生效</p> <p>虽然设置 CORS 和前端没什么关系，但是通过这种方式解决跨域问题的话，会在发送请求时出现两种情况，分别为简单请求和复杂请求</p> <ul><li>demo</li></ul> <p>服务端返回时增加响应头</p> <p>Access-Control-Allow-Origin 前端的域名</p> <p>Access-Control-Allow-Credentials true</p> <p>Access-Control-Allow-Methods: GET POST PUT OPTIONS PATCH（运行跨域的请求类型）</p> <p>Access-Control-Expose-Headers 允许前端发送的额外请求头</p> <p>比如 NodeJS， <a href="https://forlornlily.github.io/server-notes/express/" target="_blank" rel="noopener noreferrer">Express<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;这是你要的数据：1111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>简单请求</li></ul> <p>以 Ajax 为例，当满足以下条件时，会触发简单请求</p> <ol><li>使用下列方法之一：</li></ol> <p>GET，HEAD，POST</p> <ol start="2"><li>HTTP 的头信息不超出以下几种字段</li></ol> <ul><li><p>Accept</p></li> <li><p>Accept-Language</p></li> <li><p>Content-Language</p></li> <li><p>Last-Event-ID</p></li> <li><p>Content-Type</p></li></ul> <ol start="3"><li>Content-Type 的值仅限于下列三者之一：</li></ol> <p>text/plain, multipart/form-data(上传), application/x-www-form-urlencoded(表单)</p> <p>不满足以上条件就会触发复杂请求</p> <ul><li>复杂请求</li></ul> <p>复杂请求来说，首先会发起一个预检请求，该请求是 option 方法的，通过该请求来知道服务端是否允许跨域请求。</p> <ul><li>OPTIONS</li></ul> <p>可能对服务器数据产生副作用的 HTTP 请求方法</p> <ol start="2"><li>cookie</li></ol> <p>CORS 请求默认不发送 Cookie 和 HTTP 认证信息</p> <p>如果要把 Cookie 发到服务器</p> <ol><li><p>服务器设置 Access-Control-Allow-Credentials 是 true</p></li> <li><p>XMLHttpRequest 设置 withCredentials 为 true</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>Access-Control-Allow-Origin 不可以是<code>*</code>，必须是具体的域名</li></ol> <h4 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h4> <p>只支持 IE10+</p> <h3 id="jsonp-json-with-padding"><a href="#jsonp-json-with-padding" class="header-anchor">#</a> JSONP(JSON with Padding)</h3> <p>本质上就是返回函数立即执行</p> <p>利用 script 标签</p> <p>script 不受限制，可以让服务器在 js 内返回内容</p> <p>前台参数传递?func=xxx</p> <p>后台接收 func 参数，返回函数</p> <ul><li>demo</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">jsonpCallback</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;获得 X 数据:&quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://127.0.0.1:3000?callback=jsonpCallback<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><p>缺点</p> <ul><li><p>只能用在 get</p></li> <li><p>不能解决 iframe 之间的通信</p></li></ul></li></ul> <h3 id="服务器代理"><a href="#服务器代理" class="header-anchor">#</a> 服务器代理</h3> <p>比如 NodeJs + webpack。比如 nginx</p> <p>http-proxy-middleware</p> <p>webpack 内置，可以使用 proxy 进行代理</p> <p><img src="data:image/png;base64,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" alt=""></p> <ul><li>NodeJS demo</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;https&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//访问topics去请求cnodejs的API</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http
  <span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token operator">===</span> <span class="token string">&quot;topics&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      https<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;https://cnodejs.org/api/v1/topics&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          data <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resp<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json; charset=utf-8&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="websocket"><a href="#websocket" class="header-anchor">#</a> WebSocket</h3> <p>只能传送简单的文本，JSON 要转成字符串</p> <p>事件有 open, close, error, message。不支持 addEventListener<br>
手动调用 close() 关闭</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws:35.201.238.65&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">hell</span><span class="token operator">:</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">onmessage</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="xmlhttprequest"><a href="#xmlhttprequest" class="header-anchor">#</a> XMLHttpRequest</h2> <p>尽可能用 fetch 代替 XMLHttpRequest<br>
Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 4表示整个请求过程已经完毕.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 200 表示一个成功的请求</span>
      <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 文本形式的内容</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://www.example.org/some.file&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true为异步，不写默认为true</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//发送给服务的参数。比如查询条件</span>
</code></pre></div><h3 id="属性"><a href="#属性" class="header-anchor">#</a> 属性</h3> <h4 id="readystate"><a href="#readystate" class="header-anchor">#</a> readyState</h4> <p>请求/响应的活动阶段。0 表示还没调用 open, 4 表示接收到所有数据</p> <h4 id="timeout"><a href="#timeout" class="header-anchor">#</a> timeout</h4> <p>毫秒为单位，超出后自动终止</p> <p><code>xhr.timeout = 2000;</code></p> <h4 id="withcredentials"><a href="#withcredentials" class="header-anchor">#</a> withCredentials</h4> <p>CORS 的情况下为 true 表示请求会携带 cookie</p> <p>xhr.withCredentials = true;</p> <h3 id="方法"><a href="#方法" class="header-anchor">#</a> 方法</h3> <h4 id="open"><a href="#open" class="header-anchor">#</a> open</h4> <ul><li>get</li></ul> <p>url 如果要传参，都需要进行 encodeURIComponent 编码</p> <ul><li><p>post</p></li> <li><p>区别</p></li></ul> <p>浏览器后退时 get 无害，post 会重新提交请求</p> <p>get 能被缓存，post 不能缓存<br>
get 只允许 ASCII 字符，post 编码类型无限制，可以用二进制<br>
get 有长度限制，因为 url 有限制（由浏览器决定，参考<a href="https://www.zhihu.com/question/391726099" target="_blank" rel="noopener noreferrer">知乎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）。post 没有<br>
浏览器的长度限制可以忽略不计，主要瓶颈在于服务端</p> <h4 id="send"><a href="#send" class="header-anchor">#</a> send</h4> <p>send 可以是字符串.send(&quot;hello&quot;)，也可以是对象{key: value}</p> <h4 id="setrequestheader"><a href="#setrequestheader" class="header-anchor">#</a> setRequestHeader</h4> <p>设置头部</p> <p><code>xhr.setRequestHeader(&quot;MyHead&quot;, &quot;MyValue&quot;)</code></p> <ul><li>Content-Type</li></ul> <p>设置 MIME 类型</p> <h4 id="abort"><a href="#abort" class="header-anchor">#</a> abort</h4> <p>终止</p> <h3 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h3> <p>参考<a href="https://zhuanlan.zhihu.com/p/25778815" target="_blank" rel="noopener noreferrer">知乎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="demo"><a href="#demo" class="header-anchor">#</a> demo</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span>
    url<span class="token punctuation">,</span>
    type <span class="token operator">=</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>
    responseType <span class="token operator">=</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
    callback<span class="token punctuation">,</span>
    data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> responseType<span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 4表示整个请求过程已经完毕.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 200 表示一个成功的请求</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> xhr<span class="token punctuation">.</span>response<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> err<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true为异步，不写默认为true</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="postmessage"><a href="#postmessage" class="header-anchor">#</a> postMessage</h4> <p>可以用在 service worker</p> <h2 id="promise"><a href="#promise" class="header-anchor">#</a> Promise</h2> <p>在 Promise 中无论是 then 还是 catch 方法，都会返回返回一个新的 Promise 对象</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>假如 then 函数执行返回 this 调用对象本身，那么 promise2 === promise1，promise2
状态也应该等于 promise1
。但是 promise2 是 reject，但是状态是不能改变的，所以应该是一个新的 Promise 对象</p> <h3 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h3> <p>以进行态(pending state)开始，表示未结束。处于 pending 状态的 promise 认为是未处理的(unsettled)</p> <p>异步操作结束后，认为是已处理的 settled，已处理可分为两种状态</p> <p>内部的 <code>[[PromiseState]]</code> 属性会被设置为 &quot;pending&quot; 、 &quot;fulfilled&quot; 或 &quot;rejected&quot;</p> <ul><li><p>已完成(fulfilled): 成功结束</p></li> <li><p>已拒绝(rejected): 未成功结束，可能是一个错误，或由其他原因导致。</p></li></ul> <h3 id="then-与-catch"><a href="#then-与-catch" class="header-anchor">#</a> then 与 catch</h3> <p>then 接受两个参数，第一个是 fulfilled 时调用，第二个是 rejected 时调用</p> <p>catch 等于 then 的第二个调用</p> <h3 id="链式调用"><a href="#链式调用" class="header-anchor">#</a> 链式调用</h3> <p>返回值做为下一个 promise 的输入值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//可以是resolve</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//resolve时改为then</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&quot;hello&quot;</span>
    <span class="token keyword">return</span> value <span class="token operator">+</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;helloworld&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="promise-all"><a href="#promise-all" class="header-anchor">#</a> Promise.all()</h3> <p>有一个被 reject 就不会进 p4 的 then</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p4 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p4<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>手写 all</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">PromiseAll</span><span class="token punctuation">(</span><span class="token parameter">arrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arrs<span class="token punctuation">]</span><span class="token punctuation">,</span>
      length <span class="token operator">=</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          count<span class="token operator">++</span><span class="token punctuation">;</span>
          result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">PromiseAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt=""></p> <h3 id="promise-race"><a href="#promise-race" class="header-anchor">#</a> Promise.race()</h3> <p>看 resolve 和 reject 谁先进，then 和 catch 只会二选一</p> <p>有一个 resolve 就立刻进 then，值只有最先 resolve 的值</p> <p>有一个 reject 就立刻进 catch</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p4 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p4<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//42，不是数组</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//不进</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="手写-promise-then"><a href="#手写-promise-then" class="header-anchor">#</a> 手写 promise.then</h3> <p>参考：</p> <ul><li><a href="https://github.com/xieranmaya/blog/issues/2" target="_blank" rel="noopener noreferrer">剖析 Promise 内部结构，一步一步教你实现一个完整的、能通过所有 Test case 的 Promise <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.im/post/5b83cb5ae51d4538cc3ec354" target="_blank" rel="noopener noreferrer">Promise 实现原理（附源码）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">pending</span><span class="token operator">:</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token string">&quot;fullfilled&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">reject</span><span class="token operator">:</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">isFucntion</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">typeof</span> obj <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">MyPromise</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  that<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
  that<span class="token punctuation">.</span>state <span class="token operator">=</span> utils<span class="token punctuation">.</span>pending<span class="token punctuation">;</span>
  that<span class="token punctuation">.</span>resolveHandles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//then执行的回调，可以链式回调，所以用数组触发</span>
  that<span class="token punctuation">.</span>rejectHandles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//catch执行的回调</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 执行fn的过程中有可能出错，用try/catch块进行异常处理
    比如
    var promise = new MyPromise(function (resolve, reject) {
      throw new Error(&quot;出错&quot;)
    }) */</span>
    <span class="token function">fn</span><span class="token punctuation">(</span>handleResolve<span class="token punctuation">,</span> handleReject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行fn</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleReject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">handleResolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> utils<span class="token punctuation">.</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/* 判断状态是为了处理以下情况
        var promise = new MyPromise(function (resolve, reject) {
          resolve(test)
          reject(test)//不应该进reject，不处理状态的话就会进handleReject了
      }) */</span>
      that<span class="token punctuation">.</span>state <span class="token operator">=</span> utils<span class="token punctuation">.</span>resolve<span class="token punctuation">;</span>
      that<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token keyword">var</span> handles <span class="token operator">=</span> that<span class="token punctuation">.</span>resolveHandles<span class="token punctuation">,</span>
        length <span class="token operator">=</span> handles<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        handles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">handleReject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> utils<span class="token punctuation">.</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      that<span class="token punctuation">.</span>state <span class="token operator">=</span> utils<span class="token punctuation">.</span>reject<span class="token punctuation">;</span>
      that<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token keyword">var</span> handles <span class="token operator">=</span> that<span class="token punctuation">.</span>handleReject<span class="token punctuation">,</span>
        length <span class="token operator">=</span> handles<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        handles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token class-name">MyPromise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
    promise <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token comment">//根据规范，如果then/reject的参数不是function，需要忽略它</span>
    onFulfilled <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">isFucntion</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
      <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span>
      <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    onRejected <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">isFucntion</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
      <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span>
      <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> utils<span class="token punctuation">.</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//onFulfilled(that.value)</span>
    <span class="token comment">//返回的仍然是Promise对象</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//仍然用try catch进行异常处理</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">/* 处理以下情况，第二次的then值是第一次then 返回的值
          promise.then(value =&gt; {
            return value + 'world'
          })
          .then(value =&gt; {
            console.log(value) 
          }) */</span>
          result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> utils<span class="token punctuation">.</span>reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//onRejected(that.value)</span>
    <span class="token comment">//同上</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>that<span class="token punctuation">.</span>state <span class="token operator">===</span> utils<span class="token punctuation">.</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* that.resolveHandles.push(onFulfilled)
    that.rejectHandles.push(onRejected) */</span>
    <span class="token comment">//不确定到底是reject还是resolve，都push进去</span>
    that<span class="token punctuation">.</span>resolveHandles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    that<span class="token punctuation">.</span>rejectHandles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value <span class="token operator">+</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="promise-finally"><a href="#promise-finally" class="header-anchor">#</a> promise.finally</h3> <p>全部 settled 就会进，没有入参</p> <h2 id="fetch"><a href="#fetch" class="header-anchor">#</a> Fetch</h2> <p>请求资源的接口，一定是异步的</p> <p>Fetch 提供了对 Request 和 Response（以及其他与网络请求有关的）对象的通用定义，除了 window 对象外还可以用在<code>service workers</code>、<code>Cache API</code>、又或者是其他处理请求和响应的方式</p> <p>返回一个 promise 对象</p> <p>两种写法</p> <ul><li><p>fetch(url , options)</p></li> <li><p>fetch(Request 实例)</p></li></ul> <h3 id="reject-的情况"><a href="#reject-的情况" class="header-anchor">#</a> reject 的情况</h3> <p>仅当网络故障时或请求被阻止时，才会标记为 reject</p> <p>也就是即使服务器返回 500 或者 404 等等，也还是进 resolve</p> <h3 id="options"><a href="#options" class="header-anchor">#</a> options</h3> <p><code>*</code>表示默认值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">answer</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 请求头，和content-type格式要对应</span>
  <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token string">&quot;no-cache&quot;</span><span class="token punctuation">,</span> <span class="token comment">// *default, no-cache, reload, force-cache, only-if-cached</span>
  <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">&quot;same-origin&quot;</span><span class="token punctuation">,</span> <span class="token comment">// include, same-origin, *omit</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;user-agent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mozilla/4.0 MDN Example&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;content-type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token comment">// *GET, POST, PUT, DELETE, etc.</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;cors&quot;</span><span class="token punctuation">,</span> <span class="token comment">// no-cors, cors, *same-origin</span>
  <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token string">&quot;follow&quot;</span><span class="token punctuation">,</span> <span class="token comment">// manual, *follow, error</span>
  <span class="token literal-property property">referrer</span><span class="token operator">:</span> <span class="token string">&quot;no-referrer&quot;</span><span class="token punctuation">,</span> <span class="token comment">// *client, no-referrer</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parses response to JSON</span>
</code></pre></div><h4 id="credentials"><a href="#credentials" class="header-anchor">#</a> credentials</h4> <p>请求是否携带 cookie, 默认&quot;omit&quot;不带</p> <h3 id="headers"><a href="#headers" class="header-anchor">#</a> Headers</h3> <p>可以在 request 请求中被发送或者在 response 请求中被接收</p> <p>request.headers/response.headers</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Headers" target="_blank" rel="noopener noreferrer">MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>增加：append(key, value)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>myHeaders<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>append 同一个 key 多次，相当于 set，会用逗号分割多个值</p> <div class="language-js extra-class"><pre class="language-js"><code>myHeaders<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myHeaders<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myHeaders<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'world, world2'</span>
</code></pre></div><ul><li><p>修改：set(key, value)</p></li> <li><p>删除：delete(key)</p></li> <li><p>获取：get(key)获取单个, getAll()获取所有</p></li></ul> <h3 id="request"><a href="#request" class="header-anchor">#</a> Request</h3> <p>new Request(url, options)</p> <p>options 不传, 默认 method 是&quot;GET&quot;,</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> myRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost/flowers.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>myRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以调用 clone 复制 <code>myRequest.close()</code></p> <h4 id="options-2"><a href="#options-2" class="header-anchor">#</a> options</h4> <p>完整属性见<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Request" target="_blank" rel="noopener noreferrer">MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> myRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost/api&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token string">'{&quot;foo&quot;:&quot;bar&quot;}'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="response"><a href="#response" class="header-anchor">#</a> Response</h3> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Response" target="_blank" rel="noopener noreferrer">MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在 service worker 内通常都是 new Response(响应内容, options);</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h1&gt;Service Unavailable&lt;/h1&gt;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">503</span><span class="token punctuation">,</span>
  <span class="token literal-property property">statusText</span><span class="token operator">:</span> <span class="token string">&quot;Service Unavailable&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="options-3"><a href="#options-3" class="header-anchor">#</a> options</h4> <ul><li><p>status: response 的状态码, 例如:200.</p></li> <li><p>statusText: 和状态码关联的状态消息, 例如: OK.</p></li> <li><p>headers: Headers 对象，对应 HTTP 的 header</p></li> <li><p>redirected：布尔值，是否重定向</p></li></ul> <h4 id="response-headers"><a href="#response-headers" class="header-anchor">#</a> response.headers</h4> <p>值是 Headers 对象</p> <p>例如</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span>myRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// process your JSON further</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Oops, we haven't got JSON!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="response-clone"><a href="#response-clone" class="header-anchor">#</a> response.clone()</h4> <p>多次使用同一个 response，需要调用 clone 进行复制</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="跨域"><a href="#跨域" class="header-anchor">#</a> 跨域</h3> <p>只能用 CORS，和 XMLHttpRequest 一样</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> myHeaders<span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;cors&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="中断"><a href="#中断" class="header-anchor">#</a> 中断</h3> <p>用 AbortController 构造函数，fetch 中用 signal 绑定</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> abortController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">signal</span><span class="token operator">:</span> abortController<span class="token punctuation">.</span>signal<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 中断：abortController.abort()</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ForlornLily/fe-notes/edit/master/docs/javascript/050_async.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">11/10/2023, 12:14:08 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fe-notes/javascript/045_proxy.html" class="prev">
        代理与反射
      </a></span> <span class="next"><a href="/fe-notes/javascript/052_bom.html">
        BOM
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/fe-notes/assets/js/app.3a168dfd.js" defer></script><script src="/fe-notes/assets/js/2.c34af4f1.js" defer></script><script src="/fe-notes/assets/js/1.4e3eb9de.js" defer></script><script src="/fe-notes/assets/js/36.581317e2.js" defer></script>
  </body>
</html>
