# 传输层

用于两台计算机之间的数据传输。

传输层有两个不同的协议：TCP 和 UDP

## UDP

UDP 是一个面向报文（报文可以理解为一段段的数据）的协议。意思就是 UDP
只是报文的搬运工，不会对报文进行任何拆分和拼接操作

具体来说：

- 在发送端，应用层将数据传递给传输层的 UDP 协议，UDP 只会给数据增加一个 UDP
  头标识下是 UDP 协议，然后就传递给网络层了

- 在接收端，网络层将数据传递给传输层，UDP 只去除 IP
  报文头就传递给应用层，不会任何拼接操作

### 特性

- 无连接的，也就是说通信不需要建立和断开连接

- 不可靠的，收到什么数据就传递什么，不会备份，也不关心对方收到没

- 没有拥塞机制，当网络条件不好的时候可能丢包比较严重。但是因此实时性强（比如用在电话会议）

- 头部信息少，开销小

- 支持一对多，多对一，多对多的传输方式

## TCP

提供可靠的字节流服务（Byte Stream Service）。

可靠：确保传送给对方

字节流服务：将大数据以报文段（segment）为单位进行管理

也就是 TCP 协议为了更容易传送大数据进行了数据分割，同时 TCP 协议能够确保数据是否传送给对方。也就只能一对一

为了确保能够准确无误地传送给对方，用了三次握手(three-way handshaking)策略

### 三次握手

为了确保传送给对方的手段

使用两个标志：SYN（synchronize）和 ACK（acknowledgement）

发送端发送 SYN 给接收端 → 接收端接受后，回传 SYN+ACK 表示确认信息 → 发送端发送带 ACK 标志的数据包，握手结束  
SYN 是建立连接  
ACK 是为了保证建立的是同一个连接

### 原因

确保双端**发送**和**接收**两个功能都要正常  
自己确认自己两个功能；对方确认自己两个功能

1. 第一次：客户端发送
   - 客户端无法确认服务器状态，只能确认自己发送正常；
   - 服务器只能确认自己接收正常
2. 第二次：服务器发送
   - 服务器确认了客户端的发送正常；确认自己发送正常
   - 客户端确认了服务器的发送、接收都正常；确认自己接收正常。
3. 第三次：服务器确认了客户端的接收也是正常的

### 断开连接时的四次握手

1. 客户端 A 认为数据发送完成，则它需要向服务端 B 发送连接释放请求（FIN）

2. B 收到 FIN 后，会发送 ACK 进行确认

3. 仍然是 B。B 将所有数据发送结束，发送 FIN

4.A 接收到 FIN，发送 ACK 表示彻底释放

类似打电话

1. A 说"我要挂了"
2. B 说"好的"
3. 然后 B 可能还有要说的，继续说完
4. A 等 B 说完，"说完了吧，我挂了"
