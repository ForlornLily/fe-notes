# JS

## 控制 emoji 输入

参考[请问怎样禁止 html5 的输入框输入表情？](https://segmentfault.com/q/1010000007329875)

## 数组分割

```ts
function getSplitArr(list, size = 10) {
  const { length } = list
  const result = []
  for (let i = 0; i < length; i += size) {
    result.push(list.slice(i, i + size))
  }
  return result
}
```

## 判断区间重合

```js
/* 是否存在重合区间 */
function isOverLap(list) {
  const { length } = list
  if (length <= 1) {
    return false
  }
  // 先排序
  list.sort((a, b) => a.min - b.min)
  for (let i = 0; i < length - 1; i += 1) {
    const left = list[i]
    const right = list[i + 1]
    const max = [left.min, right.min]
    const min = [left.max, left.max]
    if (Math.max.apply(null, max) <= Math.min.apply(null, min)) {
      return true
    }
  }
  return false
}
```

## 视频截图

获取当前 video 标签的内容，用 canvas 画图

```html
<!-- 设置允许跨域，否则按照谷歌的安全策略，不允许调用 canvas.toDataURL -->
<video controls src="demo" crossorigin="Anonymous" id="video" />
```

```js
// 将 base64 转为 File 对象
function transToFile(dataurl, filename) {
  if (window) {
    let arr = dataurl.split(',')
    const mime = arr[0].match(/:(.*?);/)[1],
      bstr = atob(arr[1])
    let n = bstr.length,
      u8arr = new Uint8Array(n)
    while (n) {
      n -= 1
      u8arr[n] = bstr.charCodeAt(n)
    }
    return new File([u8arr], filename, { type: mime })
  }
  return false
}
function handleSnapshot() {
  const video = document.getElementById('video')
  const canvas = document.createElement('canvas')

  video.pause()
  canvas.width = video.offsetWidth
  canvas.height = video.offsetHeight
  const context = canvas.getContext('2d')
  if (!context) {
    console.error('截图出错，浏览器不支持')
    return
  }
  context.drawImage(video, 0, 0, canvas.width, canvas.height)
  const dataURL = canvas.toDataURL()
  const result = transToFile(dataURL, 'test.png')
  if (result) {
    // 上传给后端
  }
}
```
